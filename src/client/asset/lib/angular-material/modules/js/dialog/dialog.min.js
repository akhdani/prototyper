(function(window,angular,undefined){"use strict";angular.module("material.components.dialog",["material.core","material.components.backdrop"]).directive("mdDialog",MdDialogDirective).provider("$mdDialog",MdDialogProvider);function MdDialogDirective($$rAF,$mdTheming){return{restrict:"E",link:function(scope,element,attr){$mdTheming(element);$$rAF(function(){var content=element[0].querySelector("md-dialog-content");if(content&&content.scrollHeight>content.clientHeight){element.addClass("md-content-overflow")}})}}}MdDialogDirective.$inject=["$$rAF","$mdTheming"];function MdDialogProvider($$interimElementProvider){var alertDialogMethods=["title","content","ariaLabel","ok"];advancedDialogOptions.$inject=["$mdDialog","$mdTheming"];dialogDefaultOptions.$inject=["$mdAria","$document","$mdUtil","$mdConstant","$mdTheming","$mdDialog","$timeout","$rootElement","$animate","$$rAF","$q"];return $$interimElementProvider("$mdDialog").setDefaults({methods:["disableParentScroll","hasBackdrop","clickOutsideToClose","escapeToClose","targetEvent","parent"],options:dialogDefaultOptions}).addPreset("alert",{methods:["title","content","ariaLabel","ok","theme"],options:advancedDialogOptions}).addPreset("confirm",{methods:["title","content","ariaLabel","ok","cancel","theme"],options:advancedDialogOptions});function advancedDialogOptions($mdDialog,$mdTheming){return{template:['<md-dialog md-theme="{{ dialog.theme }}" aria-label="{{ dialog.ariaLabel }}">','<md-dialog-content role="document" tabIndex="-1">','<h2 class="md-title">{{ dialog.title }}</h2>',"<p>{{ dialog.content }}</p>","</md-dialog-content>",'<div class="md-actions">',"<md-button ng-if=\"dialog.$type == 'confirm'\""+' ng-click="dialog.abort()" class="md-primary">',"{{ dialog.cancel }}","</md-button>",'<md-button ng-click="dialog.hide()" class="md-primary">',"{{ dialog.ok }}","</md-button>","</div>","</md-dialog>"].join(""),controller:function mdDialogCtrl(){this.hide=function(){$mdDialog.hide(true)};this.abort=function(){$mdDialog.cancel()}},controllerAs:"dialog",bindToController:true,theme:$mdTheming.defaultTheme()}}function dialogDefaultOptions($mdAria,$document,$mdUtil,$mdConstant,$mdTheming,$mdDialog,$timeout,$rootElement,$animate,$$rAF,$q){return{hasBackdrop:true,isolateScope:true,onShow:onShow,onRemove:onRemove,clickOutsideToClose:false,escapeToClose:true,targetEvent:null,focusOnOpen:true,disableParentScroll:true,transformTemplate:function(template){return'<div class="md-dialog-container">'+template+"</div>"}};function trapFocus(ev){var dialog=document.querySelector("md-dialog");if(dialog&&!dialog.contains(ev.target)){ev.stopImmediatePropagation();dialog.focus()}}function onShow(scope,element,options){angular.element($document[0].body).addClass("md-dialog-is-showing");element=$mdUtil.extractElementByName(element,"md-dialog");options.parent=angular.element(options.parent);options.popInTarget=angular.element((options.targetEvent||{}).target);var closeButton=findCloseButton();if(options.hasBackdrop){var computeFrom=options.parent[0]==$document[0].body&&$document[0].documentElement&&$document[0].documentElement.scrollTop?angular.element($document[0].documentElement):options.parent;var parentOffset=computeFrom.prop("scrollTop");options.backdrop=angular.element('<md-backdrop class="md-dialog-backdrop md-opaque">');options.backdrop.css("top",parentOffset+"px");$mdTheming.inherit(options.backdrop,options.parent);$animate.enter(options.backdrop,options.parent);element.css("top",parentOffset+"px")}var role="dialog",elementToFocus=closeButton;if(options.$type==="alert"){role="alertdialog";elementToFocus=element.find("md-dialog-content")}configureAria(element.find("md-dialog"),role,options);document.addEventListener("focus",trapFocus,true);if(options.disableParentScroll){options.lastOverflow=options.parent.css("overflow");options.parent.css("overflow","hidden")}return dialogPopIn(element,options.parent,options.popInTarget&&options.popInTarget.length&&options.popInTarget).then(function(){applyAriaToSiblings(element,true);if(options.escapeToClose){options.rootElementKeyupCallback=function(e){if(e.keyCode===$mdConstant.KEY_CODE.ESCAPE){$timeout($mdDialog.cancel)}};$rootElement.on("keyup",options.rootElementKeyupCallback)}if(options.clickOutsideToClose){options.dialogClickOutsideCallback=function(ev){if(ev.target===element[0]){$timeout($mdDialog.cancel)}};element.on("click",options.dialogClickOutsideCallback)}if(options.focusOnOpen){elementToFocus.focus()}});function findCloseButton(){var closeButton=element[0].querySelector(".dialog-close");if(!closeButton){var actionButtons=element[0].querySelectorAll(".md-actions button");closeButton=actionButtons[actionButtons.length-1]}return angular.element(closeButton)}}function onRemove(scope,element,options){angular.element($document[0].body).removeClass("md-dialog-is-showing");if(options.backdrop){$animate.leave(options.backdrop)}if(options.disableParentScroll){options.parent.css("overflow",options.lastOverflow);delete options.lastOverflow}if(options.escapeToClose){$rootElement.off("keyup",options.rootElementKeyupCallback)}if(options.clickOutsideToClose){element.off("click",options.dialogClickOutsideCallback)}applyAriaToSiblings(element,false);document.removeEventListener("focus",trapFocus,true);return dialogPopOut(element,options.parent,options.popInTarget&&options.popInTarget.length&&options.popInTarget).then(function(){element.remove();options.popInTarget&&options.popInTarget.focus()})}function configureAria(element,role,options){element.attr({role:role,tabIndex:"-1"});var dialogContent=element.find("md-dialog-content");if(dialogContent.length===0){dialogContent=element}var dialogId=element.attr("id")||"dialog_"+$mdUtil.nextUid();dialogContent.attr("id",dialogId);element.attr("aria-describedby",dialogId);if(options.ariaLabel){$mdAria.expect(element,"aria-label",options.ariaLabel)}else{$mdAria.expectAsync(element,"aria-label",function(){var words=dialogContent.text().split(/\s+/);if(words.length>3)words=words.slice(0,3).concat("...");return words.join(" ")})}}function isNodeOneOf(elem,nodeTypeArray){if(nodeTypeArray.indexOf(elem.nodeName)!==-1){return true}}function applyAriaToSiblings(element,value){var attribute="aria-hidden";element=element[0];function walkDOM(element){while(element.parentNode){if(element===document.body){return}var children=element.parentNode.children;for(var i=0;i<children.length;i++){if(element!==children[i]&&!isNodeOneOf(children[i],["SCRIPT","STYLE"])){children[i].setAttribute(attribute,value)}}walkDOM(element=element.parentNode)}}walkDOM(element)}function dialogPopIn(container,parentElement,clickElement){var dialogEl=container.find("md-dialog");parentElement.append(container);transformToClickElement(dialogEl,clickElement);$$rAF(function(){dialogEl.addClass("transition-in").css($mdConstant.CSS.TRANSFORM,"")});return $mdUtil.transitionEndPromise(dialogEl)}function dialogPopOut(container,parentElement,clickElement){var dialogEl=container.find("md-dialog");dialogEl.addClass("transition-out").removeClass("transition-in");transformToClickElement(dialogEl,clickElement);return $mdUtil.transitionEndPromise(dialogEl)}function transformToClickElement(dialogEl,clickElement){if(clickElement){var clickRect=clickElement[0].getBoundingClientRect();var dialogRect=dialogEl[0].getBoundingClientRect();var scaleX=Math.min(.5,clickRect.width/dialogRect.width);var scaleY=Math.min(.5,clickRect.height/dialogRect.height);dialogEl.css($mdConstant.CSS.TRANSFORM,"translate3d("+(-dialogRect.left+clickRect.left+clickRect.width/2-dialogRect.width/2)+"px,"+(-dialogRect.top+clickRect.top+clickRect.height/2-dialogRect.height/2)+"px,"+"0) scale("+scaleX+","+scaleY+")")}}function dialogTransitionEnd(dialogEl){var deferred=$q.defer();dialogEl.on($mdConstant.CSS.TRANSITIONEND,finished);function finished(ev){if(ev.target===dialogEl[0]){dialogEl.off($mdConstant.CSS.TRANSITIONEND,finished);deferred.resolve()}}return deferred.promise}}}MdDialogProvider.$inject=["$$interimElementProvider"]})(window,window.angular);