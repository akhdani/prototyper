goog.provide("ng.material.components.bottomSheet");goog.require("ng.material.components.backdrop");goog.require("ng.material.core");angular.module("material.components.bottomSheet",["material.core","material.components.backdrop"]).directive("mdBottomSheet",MdBottomSheetDirective).provider("$mdBottomSheet",MdBottomSheetProvider);function MdBottomSheetDirective(){return{restrict:"E"}}function MdBottomSheetProvider($$interimElementProvider){var CLOSING_VELOCITY=.5;var PADDING=80;bottomSheetDefaults.$inject=["$animate","$mdConstant","$mdUtil","$timeout","$compile","$mdTheming","$mdBottomSheet","$rootElement","$mdGesture"];return $$interimElementProvider("$mdBottomSheet").setDefaults({methods:["disableParentScroll","escapeToClose","targetEvent"],options:bottomSheetDefaults});function bottomSheetDefaults($animate,$mdConstant,$mdUtil,$timeout,$compile,$mdTheming,$mdBottomSheet,$rootElement,$mdGesture){var backdrop;return{themable:true,targetEvent:null,onShow:onShow,onRemove:onRemove,escapeToClose:true,disableParentScroll:true};function onShow(scope,element,options){element=$mdUtil.extractElementByName(element,"md-bottom-sheet");backdrop=$compile('<md-backdrop class="md-opaque md-bottom-sheet-backdrop">')(scope);backdrop.on("click",function(){$timeout($mdBottomSheet.cancel)});$mdTheming.inherit(backdrop,options.parent);$animate.enter(backdrop,options.parent,null);var bottomSheet=new BottomSheet(element,options.parent);options.bottomSheet=bottomSheet;options.targetEvent&&angular.element(options.targetEvent.target).blur();$mdTheming.inherit(bottomSheet.element,options.parent);if(options.disableParentScroll){options.lastOverflow=options.parent.css("overflow");options.parent.css("overflow","hidden")}return $animate.enter(bottomSheet.element,options.parent).then(function(){var focusable=angular.element(element[0].querySelector("button")||element[0].querySelector("a")||element[0].querySelector("[ng-click]"));focusable.focus();if(options.escapeToClose){options.rootElementKeyupCallback=function(e){if(e.keyCode===$mdConstant.KEY_CODE.ESCAPE){$timeout($mdBottomSheet.cancel)}};$rootElement.on("keyup",options.rootElementKeyupCallback)}})}function onRemove(scope,element,options){var bottomSheet=options.bottomSheet;$animate.leave(backdrop);return $animate.leave(bottomSheet.element).then(function(){if(options.disableParentScroll){options.parent.css("overflow",options.lastOverflow);delete options.lastOverflow}bottomSheet.cleanup();options.targetEvent&&angular.element(options.targetEvent.target).focus()})}function BottomSheet(element,parent){var deregister=$mdGesture.register(parent,"drag",{horizontal:false});parent.on("$md.dragstart",onDragStart).on("$md.drag",onDrag).on("$md.dragend",onDragEnd);return{element:element,cleanup:function cleanup(){deregister();parent.off("$md.dragstart",onDragStart).off("$md.drag",onDrag).off("$md.dragend",onDragEnd)}};function onDragStart(ev){element.css($mdConstant.CSS.TRANSITION_DURATION,"0ms")}function onDrag(ev){var transform=ev.pointer.distanceY;if(transform<5){transform=Math.max(-PADDING,transform/2)}element.css($mdConstant.CSS.TRANSFORM,"translate3d(0,"+(PADDING+transform)+"px,0)")}function onDragEnd(ev){if(ev.pointer.distanceY>0&&(ev.pointer.distanceY>20||Math.abs(ev.pointer.velocityY)>CLOSING_VELOCITY)){var distanceRemaining=element.prop("offsetHeight")-ev.pointer.distanceY;var transitionDuration=Math.min(distanceRemaining/ev.pointer.velocityY*.75,500);element.css($mdConstant.CSS.TRANSITION_DURATION,transitionDuration+"ms");$timeout($mdBottomSheet.cancel)}else{element.css($mdConstant.CSS.TRANSITION_DURATION,"");element.css($mdConstant.CSS.TRANSFORM,"")}}}}}MdBottomSheetProvider.$inject=["$$interimElementProvider"];ng.material.components.bottomSheet=angular.module("material.components.bottomSheet");