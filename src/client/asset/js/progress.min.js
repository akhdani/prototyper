(function(root,factory){if(typeof exports==="object"){factory(exports)}else if(typeof define==="function"&&define.amd){define(["exports"],factory)}else{factory(root)}})(this,function(exports){var VERSION="0.1.0";function ProgressJs(obj){if(typeof obj.length!="undefined"){this._targetElement=obj}else{this._targetElement=[obj]}if(typeof window._progressjsId==="undefined")window._progressjsId=1;if(typeof window._progressjsIntervals==="undefined")window._progressjsIntervals={};this._options={theme:"blue",overlayMode:false,considerTransition:true}}function _startProgress(){if(typeof this._onBeforeStartCallback!="undefined"){this._onBeforeStartCallback.call(this)}_createContainer.call(this);for(var i=0,elmsLength=this._targetElement.length;i<elmsLength;i++){_setProgress.call(this,this._targetElement[i])}}function _setProgress(targetElement){if(targetElement.hasAttribute("data-progressjs"))return;var targetElementOffset=_getOffset.call(this,targetElement);targetElement.setAttribute("data-progressjs",window._progressjsId);var progressElementContainer=document.createElement("div");progressElementContainer.className="progressjs-progress progressjs-theme-"+this._options.theme;if(targetElement.tagName.toLowerCase()==="body"){progressElementContainer.style.position="fixed"}else{progressElementContainer.style.position="absolute"}progressElementContainer.setAttribute("data-progressjs",window._progressjsId);var progressElement=document.createElement("div");progressElement.className="progressjs-inner";var progressPercentElement=document.createElement("div");progressPercentElement.className="progressjs-percent";progressPercentElement.innerHTML="1%";progressElement.appendChild(progressPercentElement);if(this._options.overlayMode&&targetElement.tagName.toLowerCase()==="body"){progressElementContainer.style.left=0;progressElementContainer.style.right=0;progressElementContainer.style.top=0;progressElementContainer.style.bottom=0}else{progressElementContainer.style.left=targetElementOffset.left+"px";progressElementContainer.style.top=targetElementOffset.top+"px";progressElementContainer.style.width=targetElementOffset.width+"px";if(this._options.overlayMode){progressElementContainer.style.height=targetElementOffset.height+"px"}}progressElementContainer.appendChild(progressElement);var container=document.querySelector(".progressjs-container");container.appendChild(progressElementContainer);_setPercentFor(targetElement,1);++window._progressjsId}function _setPercent(percent){for(var i=0,elmsLength=this._targetElement.length;i<elmsLength;i++){_setPercentFor.call(this,this._targetElement[i],percent)}}function _setPercentFor(targetElement,percent){var self=this;if(percent>=100)percent=100;if(targetElement.hasAttribute("data-progressjs")){setTimeout(function(){if(typeof self._onProgressCallback!="undefined"){self._onProgressCallback.call(self,targetElement,percent)}var percentElement=_getPercentElement(targetElement);if(percentElement)percentElement.style.width=parseInt(percent)+"%";var percentElement=percentElement?percentElement.querySelector(".progressjs-percent"):null;var existingPercent=percentElement?parseInt(percentElement.innerHTML.replace("%","")):0;(function(percentElement,existingPercent,currentPercent){var increasement=true;if(existingPercent>currentPercent){increasement=false}var intervalIn=10;function changePercentTimer(percentElement,existingPercent,currentPercent){var distance=Math.abs(existingPercent-currentPercent);if(distance<3){intervalIn=30}else if(distance<20){intervalIn=20}else{intervanIn=1}if(percentElement&&existingPercent-currentPercent!=0){percentElement.innerHTML=(increasement?++existingPercent:--existingPercent)+"%";setTimeout(function(){changePercentTimer(percentElement,existingPercent,currentPercent)},intervalIn)}}changePercentTimer(percentElement,existingPercent,currentPercent)})(percentElement,existingPercent,parseInt(percent))},50)}}function _getPercentElement(targetElement){var progressjsId=parseInt(targetElement.getAttribute("data-progressjs"));return document.querySelector('.progressjs-container > .progressjs-progress[data-progressjs="'+progressjsId+'"] > .progressjs-inner')}function _autoIncrease(size,millisecond){var self=this;var progressjsId=parseInt(this._targetElement[0].getAttribute("data-progressjs"));if(typeof window._progressjsIntervals[progressjsId]!="undefined"){clearInterval(window._progressjsIntervals[progressjsId])}window._progressjsIntervals[progressjsId]=setInterval(function(){_increasePercent.call(self,size)},millisecond)}function _increasePercent(size){for(var i=0,elmsLength=this._targetElement.length;i<elmsLength;i++){var currentElement=this._targetElement[i];if(currentElement.hasAttribute("data-progressjs")){var percentElement=_getPercentElement(currentElement);var existingPercent=percentElement?parseInt(percentElement.style.width.replace("%","")):0;if(existingPercent){_setPercentFor.call(this,currentElement,existingPercent+(size||1))}}}}function _end(){if(typeof this._onBeforeEndCallback!="undefined"){if(this._options.considerTransition===true){_getPercentElement(this._targetElement[0]).addEventListener(whichTransitionEvent(),this._onBeforeEndCallback,false)}else{this._onBeforeEndCallback.call(this)}}var progressjsId=this._targetElement[0]?parseInt(this._targetElement[0].getAttribute("data-progressjs")):null;for(var i=0,elmsLength=this._targetElement.length;i<elmsLength;i++){var currentElement=this._targetElement[i];var percentElement=_getPercentElement(currentElement);if(!percentElement)return;var existingPercent=parseInt(percentElement.style.width.replace("%",""));var timeoutSec=1;if(existingPercent<100){_setPercentFor.call(this,currentElement,100);timeoutSec=500}(function(percentElement,currentElement){setTimeout(function(){percentElement.parentNode.className+=" progressjs-end";setTimeout(function(){if(percentElement.parentNode.parentNode)percentElement.parentNode.parentNode.removeChild(percentElement.parentNode);currentElement.removeAttribute("data-progressjs")},1e3)},timeoutSec)})(percentElement,currentElement)}if(window._progressjsIntervals[progressjsId]){try{clearInterval(window._progressjsIntervals[progressjsId]);window._progressjsIntervals[progressjsId]=null;delete window._progressjsIntervals[progressjsId]}catch(ex){}}}function _createContainer(){if(!document.querySelector(".progressjs-container")){var containerElement=document.createElement("div");containerElement.className="progressjs-container";document.body.appendChild(containerElement)}}function _getOffset(element){var elementPosition={};if(element.tagName.toLowerCase()==="body"){elementPosition.width=element.clientWidth;elementPosition.height=element.clientHeight}else{elementPosition.width=element.offsetWidth;elementPosition.height=element.offsetHeight}var _x=0;var _y=0;while(element&&!isNaN(element.offsetLeft)&&!isNaN(element.offsetTop)){_x+=element.offsetLeft;_y+=element.offsetTop;element=element.offsetParent}elementPosition.top=_y;elementPosition.left=_x;return elementPosition}function _mergeOptions(obj1,obj2){var obj3={};for(var attrname in obj1){obj3[attrname]=obj1[attrname]}for(var attrname in obj2){obj3[attrname]=obj2[attrname]}return obj3}var progressJs=function(targetElm){if(typeof targetElm==="object"){return new ProgressJs(targetElm)}else if(typeof targetElm==="string"){var targetElement=document.querySelectorAll(targetElm);if(targetElement){return new ProgressJs(targetElement)}else{throw new Error("There is no element with given selector.")}}else{return new ProgressJs(document.body)}};function whichTransitionEvent(){var t;var el=document.createElement("fakeelement");var transitions={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in transitions){if(el.style[t]!==undefined){return transitions[t]}}}progressJs.version=VERSION;progressJs.fn=ProgressJs.prototype={clone:function(){return new ProgressJs(this)},setOption:function(option,value){this._options[option]=value;return this},setOptions:function(options){this._options=_mergeOptions(this._options,options);return this},start:function(){_startProgress.call(this);return this},set:function(percent){_setPercent.call(this,percent);return this},increase:function(size){_increasePercent.call(this,size);return this},autoIncrease:function(size,millisecond){_autoIncrease.call(this,size,millisecond);return this},end:function(){_end.call(this);return this},onbeforeend:function(providedCallback){if(typeof providedCallback==="function"){this._onBeforeEndCallback=providedCallback}else{throw new Error("Provided callback for onbeforeend was not a function")}return this},onbeforestart:function(providedCallback){if(typeof providedCallback==="function"){this._onBeforeStartCallback=providedCallback}else{throw new Error("Provided callback for onbeforestart was not a function")}return this},onprogress:function(providedCallback){if(typeof providedCallback==="function"){this._onProgressCallback=providedCallback}else{throw new Error("Provided callback for onprogress was not a function")}return this}};exports.progressJs=progressJs;return progressJs});